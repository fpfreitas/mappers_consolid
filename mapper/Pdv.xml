<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Pdv">

	<select id="selectCupom" resultMap="selectCupom">
		<![CDATA[
                 SELECT    FILIAL.CGC					    ,
						   VD.CD_EMP                        ,
                           VD.CD_FILIAL                     ,
                           VD.NR_ORC                        ,
                           VD.CD_CX                         ,
                           VD.DT_VD                         ,
                           COALESCE(VD.DT_CAD, VD.DT_VD)    AS DT_CAD,
                           COALESCE(VD.HR_VD, VD.DT_CAD)    AS HR_VD,
                           VD.NR_PED_TELEVD                 ,
                           VD.ORIG_ORC                      ,
                           VD.VLR_CARTAO                    ,
                           VD.CD_VD                         ,
                           VD.NR_ECF                        ,
                           VD.ST_VD                         ,
                           VD.CONT_CUPOM_FISC               ,
                           VD.CD_MOV                        ,
                           CASE 
							WHEN VD.CD_CLI = 0
							THEN 1 
							ELSE VD.CD_CLI  END AS CD_CLI,
                           VD.CGC_CPF                       ,
                           VD.NR_CARTAO_MARKA               ,                   
                           COALESCE(VD.QTD_DIAS_PRORROG, 0) AS QTD_DIAS_PRORROG,
                           VD.VLR_LIQ_VD                    ,
                           VD.VLR_TOT_PROD                  ,
                           VD.VLR_VD                        ,
                           VD.VLR_DESC                      ,
                           VD.VLR_DESC_ITENS                ,
						   VD.VLR_DINH                      ,
                           VD.VLR_TROCO                     ,
                           CASE 
                                     WHEN VD.TIPO_PBM > 0 
                                     AND       COALESCE(VD.VLR_CONV_PBM, 0::NUMERIC) = 0::NUMERIC
                                     AND       VD.VLR_CONV = 0::NUMERIC THEN 0::NUMERIC 
                                     ELSE VD.VLR_CONV 
                           END                                                            AS VLR_CONV,
						   VD.CD_CONV													  ,
                           VD.QT_PARC_CONV                  							  ,
                           VD.VLR_DUP                                                     ,
                           VD.VL_CHQS_A_VISTA                                             ,
                           VD.VL_CHQS_A_PRZ                                               ,                    
                           VD.NR_CEL_RECARGA                                              ,
                           VD.VLR_RECARGA_CEL                                             ,
                           VD.NM_OPER_CEL                                                 ,
                           VD.NM_COMPRADOR                                                ,
                           VD.DADOS_ADICIONAIS                                            ,
                           VD.NR_SERIE_IMP                                                ,
                           VD.VS_PDV                                                      ,
                           VD.VS_PDV_RC                                                   ,
                           VD.CD_USU                                                      ,
                           VD.CD_USU_CANCEL                                               ,
                           VD.CD_MT_CANCEL                                                ,
                           COALESCE(VD.ST_CANC_PAF, 0)                                    AS ST_CANC_PAF,
                           COALESCE(AUDIT.CD_OUTR_PROCD, 0::NUMERIC)                      AS CD_OUTR_PROCD,
                           COALESCE(AUDIT.CD_USU, 0::       NUMERIC)                      AS CD_USU_PROCEDIMENTO,
                           COALESCE(VD.CD_CLI_PBM      , 0::NUMERIC)                      AS CD_CLI_PBM,
                           COALESCE(VD.REG_ALTERADO, 0)                                   AS REG_ALTERADO,
                           VD.VD_TROCA_FIDEL                                              ,
                           COALESCE(VD.VLR_IMPOSTO, 0::   NUMERIC)                        AS VLR_IMPOSTO,
                           COALESCE(VD.TX_MED_IMPOSTO, 0::NUMERIC)                        AS TX_MED_IMPOSTO,
						   COALESCE(VD.VLR_TICKETS, 0::NUMERIC)                           AS VLR_TICKETS,
                           VD.VLR_CONV_PBM                                                ,
                           VD.FLAG_NFCE                                                   ,
                           COALESCE(NF_SAI.CD_NF, 0::   NUMERIC)                          AS CD_NF,
                           COALESCE(VD.NR_CARTAO_MARKA, ''::CHARACTER VARYING)            AS NR_CARTAO_MARKA,
                           COALESCE(VD.QTDE_PONTOS_FIDEL_EXTERNO, 0::NUMERIC)             AS QTDE_PONTOS_FIDEL_EXTERNO,
                           COALESCE(VD.NR_TEL_CUPOM, ''::CHARACTER VARYING)               AS NR_TEL_CUPOM,
						   COALESCE(VD.CHV_NFCE ,''::CHARACTER VARYING)                   AS CHV_NFCE	,
							VD.CD_NF_SERIE
                 FROM      PDV_VD VD 
                 LEFT JOIN PDV_VD_EST_NF_SAI NF_SAI 
                 ON        VD.CD_EMP = NF_SAI.CD_EMP 
                 AND       VD.CD_FILIAL = NF_SAI.CD_FILIAL 
                 AND       VD.CD_VD = NF_SAI.CD_VD 

                 LEFT JOIN PDV_VD_GLB_PROCD_OUTR_LIB AUDIT 
                 ON        VD.CD_EMP = AUDIT.CD_EMP 
                 AND       VD.CD_FILIAL = AUDIT.CD_FILIAL 
                 AND       VD.CD_VD = AUDIT.CD_VD 
                 AND       ( 
                                     AUDIT.CD_OUTR_PROCD = ANY (ARRAY[90::numeric, 91::numeric, 93::numeric, 94::numeric]))
									 
				INNER JOIN PRC_FILIAL FILIAL ON
					VD.CD_EMP = FILIAL.CD_EMP
					AND VD.CD_FILIAL = FILIAL.CD_FILIAL
                 WHERE VD.FLAG_CONSOLIDADO = #{flagConsolid}::numeric
                 AND VD.ST_VD >= 0  LIMIT 1

]]>
	</select>
	<select id="selectCupomNfce" resultMap="selectCupomNfce">
		SELECT 	CD_EMP,
				CD_FILIAL,
				CD_NF ,
				CD_NF_SERIE ,
				CHV_NFCE ,
				AUT_NFCE ,
				XML_NFCE     AS "XML_NFCE",
				DS_MOTIVO ,
				COALESCE(STS_PEND, 0::   NUMERIC) AS "STS_VALID"
        FROM EST_NFCE_ENV WHERE
        CD_EMP = #{cdEmp}
        AND CD_FILIAL = #{cdFilial}
        AND CD_NF = #{cdNf} 
        AND CD_NF_SERIE = #{cdNfSerie}
	</select>
	<select id="selectCupomNfceCancel" resultMap="selectCupomNfceCancel">
	SELECT 	NFCE_CANCEL.XML_CANC                                                   AS XML_CANC,
			COALESCE(NFCE_CANCEL.TP_CANC, 0)                                        AS TP_CANC,
			COALESCE(NFCE_CANCEL.CHV_NFCE, ''::CHARACTER VARYING)                   AS CHV_NFCE,
			NFCE_CANCEL.DT_EMIS                                                     AS DT_EMIS,
			COALESCE(NFCE_CANCEL.AUT_CANC, ''::CHARACTER VARYING)                   AS AUT_CANC,
			COALESCE(NFCE_CANCEL.DS_MOTIVO, ''::CHARACTER VARYING)                  AS DS_MOTIVO
    FROM 
		EST_NFCE_CANC NFCE_CANCEL 
	WHERE
		NFCE_CANCEL.CD_EMP = #{cdEmp}
		AND NFCE_CANCEL.CD_FILIAL = #{cdFilial}
		AND NFCE_CANCEL.CD_VD = #{cdVd}
	</select>
	<select id="selectCupomItens" resultMap="selectCupomItens">
		SELECT    
		IT.CD_EMP                                                           ,
		IT.CD_FILIAL                                                        ,
		IT.CD_VD                                                            ,
		IT.CD_IT                                                            ,
		IT.CD_BARRAS					                                    ,
        IT.CD_PROD                                                          ,
        IT.QT_IT                                                            ,
        IT.VLR_IT                                                           ,
        IT.VLR_LIQ_IT                                                       ,
        IT.ST_IT                                                            ,
        IT.TIPO_DESCONTO                                                    ,
        COALESCE(IT.TX_DESC, 0::         NUMERIC)  AS TX_DESC               ,
		COALESCE(IT.PERC_DESC_VERBA, 0::  NUMERIC) AS PERC_DESC_VERBA       ,
        COALESCE(IT.VLR_DESC_VERBA, 0::  NUMERIC)  AS VLR_DESC_VERBA        ,
        COALESCE(IT.VLR_DESC_TOT_RAT, 0::NUMERIC)  AS VLR_DESC_TOT_RAT      ,
        IT.CD_TRIB_FC                                                       ,
        IT.TX_ICMS_IT                                                       ,
        IT.TX_RED_IT                                                        ,
        IT.CD_VEND                                                          ,
        IT.CD_VEND_VERBA                                                    ,
        IT.CD_USU_CANCEL                                                    ,
        IT.QTDE_PONTO_FIDEL                                                 ,
        IT.CD_GRP_COMIS_PDV                                                 ,
        COALESCE(IT.REG_ALTERADO, 0) = 1          AS REG_ALTERADO           ,
        COALESCE(IT.TIPO_IMPOSTO, 0::NUMERIC)     AS TIPO_IMPOSTO           ,
        IT.VLR_IMPOSTO_IT                                                   ,
        IT.TX_IMPOSTO_IT                                                    ,
        IT.NR_PROTOCOLO_MANIPULADO                                          ,
        COALESCE(IT.PERC_DESC_DIFF, 0::NUMERIC)   AS PERC_DESC_DIFF         ,
        COALESCE(IT.PERC_DESC_MAX, 0:: NUMERIC)   AS PERC_DESC_MAX          ,
        COALESCE(IT.PERC_DESC_MIN, 0:: NUMERIC)   AS PERC_DESC_MIN          ,
        COALESCE(IT.CD_TBL_DESC, 0::   NUMERIC)   AS CD_TBL_DESC            ,
        COALESCE(IT.TP_NIVEL, 0::      NUMERIC)   AS TP_NIVEL               ,
		COALESCE(it.tp_tbl_desc::numeric, 0::numeric) AS TP_TBL_DESC        
        FROM      PDV_VD_IT IT 
        WHERE     IT.CD_EMP = #{cdEmp} 
        AND       IT.CD_FILIAL = #{cdFilial} 
        AND       IT.CD_VD = #{cdVd} 
	</select>
	<select id="selectCupomItensLote" resultMap="selectCupomItensLote">
		SELECT  CD_LOTE, 
				NR_LOTE, 
				QTDE_LOTE 
		FROM PDV_VD_IT_LOTE LOTE
		WHERE LOTE.CD_EMP  = #{cdEmp}
		AND LOTE.CD_FILIAL = #{cdFilial}
		AND LOTE.CD_VD     = #{cdVd}
		AND LOTE.CD_IT     = #{cdIt}
	</select>
	<select id="selectOrcamentoPdv" resultMap="OrcaJsonResult">
		<![CDATA[
	
	 SELECT  orc.cd_emp              ,
			orc.cd_filial           ,
            orc.cd_orc              ,
            orc.vd_troca_fidel      ,
            orc.cd_cli              ,
            orc.cd_conv             ,
            orc.qt_parc_conv        ,
            orc.nr_ped_televd       ,
            orc.tipo_prazo_pgto     ,
            orc.nr_cartao_pbm       ,
            orc.cd_projeto_pbm      ,
            orc.tp_perc_rec_conv    ,
            orc.perc_rec_conv       ,
            orc.dados_adicionais    ,
            orc.nm_comprador        ,
            orc.qtd_dias_prorrog    ,
            orc.tipo_pbm            ,
            orc.cd_cli_dep          ,
            orc.vlr_prod            ,
            orc.tp_orc_entg         ,
            2		      AS sts_orc, 
            orc.nm_cli              ,
            orc.nr_autr_pbm         ,
            orc.cpf_cli_pbm         ,
            orc.dt_emi              ,
            orc.hr_emi              ,
            orc.vlr_tot             ,
			orc.vlr_desc			,
			orc.vlr_desc_geral		,
            orc.nr_cartao_fidelidade,
            orc.fone_cli            ,
            orc.tp_orc              ,
            orc.cd_frm_pgto         ,
            orc.orig_orc            ,
            orc.obs                 ,
            COALESCE(est_cancel.cd_mt_cancel_orc, 0) AS cd_mt_cancel_orc,
            est_cancel.desc_mt_cancel             			
			FROM      est_orc orc 
                 left join est_orc_mt_cancel est_cancel 
                 ON        est_cancel.cd_emp::   NUMERIC = orc.cd_emp::NUMERIC 
                 AND       est_cancel.cd_filial::NUMERIC = orc.cd_filial::NUMERIC 
                 AND       est_cancel.cd_orc::   NUMERIC = orc.cd_orc::NUMERIC 
				 WHERE     orc.cd_emp = #{cdEmp}
				AND       orc.CD_FILIAL = #{cdFilial}
				AND       orc.CD_ORC = #{nrOrc}
				 
				 	]]>

	</select>	
	<select id="selectOrcamentoPdvItem" resultMap="OrcamentoItem">                    
    SELECT    est_orc_cpl.cd_prod                 ,
              est_orc_cpl.cd_barra                ,
              est_orc_cpl.cd_emp                  ,
              est_orc_cpl.cd_filial               ,
              est_orc_cpl.qt                      ,
              est_orc_cpl.vlr_it                  ,
              est_orc_cpl.vlr_tot_it              ,
              est_orc_cpl.vlr_desc                ,
              est_orc_cpl.perc_desc               ,
              est_orc_cpl.cd_medico_rec           ,
              est_orc_cpl.cd_vend                 ,
              est_orc_cpl.cd_vend_lib             ,
              est_orc_cpl.pr_tab                  ,
              est_orc_cpl.nr_autr_pbm_item        ,
              est_orc_cpl.cd_vend_verba           ,
              est_orc_cpl.libera_vd_conv          ,
              est_orc_cpl.cd_it                   ,
              est_orc_cpl.perc_desc_min           ,
              est_orc_cpl.perc_desc_max           ,
              est_orc_cpl.cd_tbl_desc             ,
              est_orc_cpl.oferta                  ,
              est_orc_cpl.perc_desc_cad           ,
              est_orc_cpl.perc_desc_fix           ,
              est_orc_cpl.vlr_desc_fix            ,
              est_orc_cpl.tipo_desconto           ,
              est_orc_cpl.vlr_economia            ,
              est_orc_cpl.venda_dependente        ,
              est_orc_cpl.perc_desconto_pos_pbm   ,
              est_orc_cpl.nr_protocolo_manipulado ,
              est_orc_cpl.tipo_desconto           ,
              est_orc_cpl.qtde_ponto_fidel        ,
              est_orc_cpl.vlr_desc_verba          ,
              est_orc_cpl.perc_desc_verba         ,
              est_orc_cpl.cd_vend_verba           ,
              est_orc_cpl.vlr_custo_semaforo      ,
              est_orc_cpl.qt_est                  ,
              est_orc_cpl.cd_orc                  ,
              est_orc_cpl.cd_grp                  
	 FROM      est_orc_cpl 
	   left join est_orc_cpl_concor desconto_concorrente
	   ON        est_orc_cpl.cd_emp = desconto_concorrente.cd_emp::      NUMERIC
	   AND       est_orc_cpl.cd_filial = desconto_concorrente.cd_filial::NUMERIC
	   AND       est_orc_cpl.cd_orc = desconto_concorrente.nr_orc::      NUMERIC
	   AND       est_orc_cpl.cd_it = desconto_concorrente.cd_it::        NUMERIC
	   AND       est_orc_cpl.cd_prod = desconto_concorrente.cd_prod::    NUMERIC
	   WHERE     est_orc_cpl.cd_emp = #{cdEmp} 
	   AND       est_orc_cpl.cd_filial = #{cdFilial}
	   AND       est_orc_cpl.cd_orc = #{cdOrc}

	</select>
	<select id="selectOrcamentoPdvItemConcorrente" resultMap="OrcamentoItemConcorrente"> 
		SELECT desconto_concorrente.cd_prod                ,
               desconto_concorrente.nr_orc                 ,
               desconto_concorrente.cd_vend                ,
               desconto_concorrente.cd_concor              ,
               desconto_concorrente.vlr_concor             ,
               desconto_concorrente.perc_desc              ,
               desconto_concorrente.cd_it                  
               from est_orc_cpl_concor desconto_concorrente
               WHERE     #{cdEmp}= desconto_concorrente.cd_emp::      NUMERIC
               AND       #{cdFilial} = desconto_concorrente.cd_filial::NUMERIC
               AND       #{cdOrc} = desconto_concorrente.nr_orc::      NUMERIC
               AND       #{cdIt} = desconto_concorrente.cd_it::        NUMERIC
               AND       #{cdProd} = desconto_concorrente.cd_prod::    NUMERIC
	</select>  	
	<select id="selectOrcamentoPdvItemLote" resultMap="OrcamentoItemLote">     

	 SELECT 
			lote.cd_lote   ,
            lote.qtde_lote 
     FROM   est_orc_cpl_lote lote
     WHERE  #{cdEmp}   = lote.cd_emp::      NUMERIC
     AND    #{cdFilial}= lote.cd_filial::NUMERIC
     AND    #{cdOrc}   = lote.cd_orc::      NUMERIC
     AND    #{cdProd}  = lote.cd_prod::    NUMERIC
     AND    #{cdIt}    = lote.cd_it::        NUMERIC 

	</select>	
	<select id="selectOrcamentoPdvReceita" resultMap="OrcamentoReceita">    
	 SELECT receita.cd_prod                   ,
            receita.cd_it                     ,
            receita.nm_comprador              ,
            receita.idade                     ,
            receita.nm_paciente               ,
            receita.receita_tipo              ,
            coalesce(receita.cid, 0)          AS cid,
            receita.uf                        ,
            receita.nr_doc_cli                ,
            receita.tipo_documento            ,
            coalesce(receita.cd_medico_rec,0) AS cd_medico_rec,
            receita.qt_prod                   ,
            receita.dt_receita                ,
            receita.tp_capt_receita           
     FROM   est_orc_glb_medico receita 
     WHERE  receita.cd_emp = #{cdEmp}
     AND    receita.cd_filial = #{cdFilial}
     AND    receita.nr_orc = #{cdOrc}

	</select>
	<select id="selectCupomReceita" resultMap="selectCupomReceita"> 
		<![CDATA[
	  SELECT  pdv_vd_it.cd_emp,
							pdv_vd_it.cd_vd,
							pdv_vd_it.cd_filial,
							pdv_vd_it.cd_it,
						    pdv_vd_it.cd_medico_rec + vdit.cd_medico_rec::numeric AS prescritor_id,
						    pdv_vd_it.nr_receita + vdit.nr_receita AS nr_receita,
							CASE
							    WHEN date_part('day'::text, min(pdv_vd_it.dt_receita)) > 0::double precision THEN pdv_vd_it.dt_receita
							    WHEN date_part('day'::text, min(vdit.dt_receita)) > 0::double precision THEN vdit.dt_receita
							    ELSE 'now'::text::date::timestamp without time zone
							END AS receita_data,
							CASE
							    WHEN pdv_vd_it.nm_comprador_receita::text <> ''::text THEN pdv_vd_it.nm_comprador_receita
							    WHEN vdit.nm_comprador::text <> ''::text THEN vdit.nm_comprador
							    ELSE ''::character varying
							END AS COMPRADOR_NOME,
							CASE
							    WHEN pdv_vd_it.nr_doc_cli_receita::text <> ''::text THEN pdv_vd_it.nr_doc_cli_receita
							    WHEN vdit.nr_doc_cli::text <> ''::text THEN vdit.nr_doc_cli
							    ELSE ''::character varying
							END AS COMPRADOR_DOC_NUMERO,
						    pdv_vd_it.tp_doc_cli_receita + vdit.tipo_documento AS COMPRADOR_DOC_TIPO,
						    COALESCE(vdit.tp_doc_exp, 0) AS tp_doc_exp,
							CASE
							    WHEN pdv_vd_it.uf_receita::text <> ''::text THEN pdv_vd_it.uf_receita
							    WHEN vdit.uf::text <> ''::text THEN vdit.uf
							    ELSE ''::character varying
							END AS COMPRADOR_DOC_UF,
						    COALESCE(vdit.cid, 0) AS PACIENTE_CID,
						    pdv_vd_it.idade_receita + vdit.idade AS PACIENTE_IDADE,
							CASE
							    WHEN pdv_vd_it.nm_paciente_receita::text <> ''::text THEN pdv_vd_it.nm_paciente_receita
							    WHEN vdit.nm_paciente::text <> ''::text THEN vdit.nm_paciente
							    ELSE ''::character varying
							END AS PACIENTE_NOME,
						    COALESCE(vdit.sexo, 0) AS PACIENTE_SEXO,
						    0 AS "pacienteTipoIdade"	
						   FROM pdv_vd_it
						     INNER JOIN pdv_vd_it_rec vdit ON pdv_vd_it.cd_emp = vdit.cd_emp AND pdv_vd_it.cd_filial = vdit.cd_filial AND pdv_vd_it.cd_prod = vdit.cd_prod AND pdv_vd_it.cd_vd = vdit.cd_vd
						   WHERE     pdv_vd_it.CD_EMP 		= #{cdEmp}
								 AND pdv_vd_it.CD_FILIAL 	= #{cdFilial}
						         AND pdv_vd_it.CD_VD 		= #{cdVd}
						  GROUP BY pdv_vd_it.cd_emp, pdv_vd_it.cd_filial, pdv_vd_it.cd_vd, pdv_vd_it.cd_it, vdit.cd_medico_rec, vdit.nr_receita, vdit.dt_receita, vdit.nm_comprador, vdit.nr_doc_cli, vdit.tipo_documento, vdit.tp_doc_exp, vdit.uf, vdit.cid, vdit.idade, vdit.nm_paciente, vdit.sexo
						  UNION
						 SELECT 
						    it.cd_emp,
							it.cd_vd,
							it.cd_filial,
							it.cd_it,
							COALESCE(orc.cd_medico_rec,0) AS prescritor_id,
							COALESCE(orc.nr_receita,0) AS receita_numero,
							COALESCE(orc.dt_receita,current_date) AS receita_data,
							COALESCE(orc.nm_comprador,NULL::character varying) AS comprador_nome,
							COALESCE(orc.nr_doc_cli,NULL::character varying) AS comprador_doc_numero,
							COALESCE(orc.tipo_documento,NULL::integer) AS comprador_doc_tipo,
							COALESCE(orc.tp_doc_exp,NULL::integer) AS comprador_doc_expedidor,
							COALESCE(orc.uf,NULL::character varying) AS comprador_doc_uf,
							NULL::integer AS paciente_cid,
							COALESCE(orc.idade,NULL::integer) AS paciente_idade,
							COALESCE(orc.nm_paciente,NULL::character varying) AS paciente_nome,
							COALESCE(orc.sexo,NULL::integer) AS paciente_sexo,
							0 AS paciente_tipo_idade
						   FROM PDV_VD_IT IT
						   JOIN est_orc_glb_medico orc ON it.cd_emp = orc.cd_emp::numeric AND it.cd_filial = orc.cd_filial::numeric AND #{nrOrc} = orc.nr_orc::numeric AND it.cd_prod = orc.cd_prod::numeric and it.cd_it = orc.cd_it
						   WHERE     IT.CD_EMP 		= #{cdEmp}
								 AND IT.CD_FILIAL 	= #{cdFilial}
						         AND IT.CD_VD 		= #{cdVd} ]]>
	</select>
	<select id="pagamentoCheque" resultMap="pagamentoCheque"> 
		SELECT    CHQ.CD_BC_CHQ                    ,
                  CHQ.NR_ORD                       ,
                  CHQ.NR_CHQ                       ,
                  CHQ.ANO_CHQ                      ,
                  CHQ.VL_CHQ                       ,
                  CHQ.DT_EMI                       ,
                  CHQ.DT_VENCTO                    ,
                  CHQ.AG_CHQ                       ,
                  CH_EMI.CD_EMI                    ,
                  CHQ.CPF_CGC_EMI                  ,
                  CHQ.NM_EMI                       ,
                  CHQ.FONE_EMI                     ,
                  CHQ.NR_CNT_CHQ                   ,
                  CHQ.AUT_CHQ                      ,
                  CHQ.COMP_CHQ                     ,
                  CHQ.C1_CHQ                       ,
                  CHQ.C2_CHQ                       ,
                  CHQ.SR_CHQ                       ,
                  CHQ.CMC7_CHQ                     ,
                  CHQ.MES_ANO_CNT_CHQ              
        FROM      PDV_VD_CHQS CHQ
        LEFT JOIN CHQ_EMI CH_EMI 
        ON        CHQ.CPF_CGC_EMI::TEXT = CH_EMI.CGC_CPF::TEXT
        WHERE     CHQ.CD_EMP = #{cdEmp}
		AND CHQ.cd_filial =  #{cdFilial}
		AND CHQ.cd_vd = #{cdVd}
	</select>
	<select id="pagamentoCrediario" resultMap="pagamentoCrediario"> 
		SELECT      TEF.CD_ADM_CARTAO   ,
					ADM.NM_USUAL        ,
					TEF.VL_CARTAO       ,
					TEF.VL_SAQUE_CARTAO ,
					ADM.PARC            ,
					TEF.COD_REDE        ,
					TEF.COD_BANDEIRA    ,
					TEF.COD_MODALIDADE  ,
					TEF.NSU_TEF         ,
					TEF.NR_AUTORIZACAO  ,
					CASE 
							  WHEN TEF.GERENCIADOR_TEF = 1 THEN 'scope'::TEXT
							  WHEN TEF.TRN_POS = 1 THEN 'pos'::TEXT
							  ELSE 'sitef'::TEXT 
					END                                   AS TEF_GATEWAY,
					COALESCE(CRED.CD_PARC, 1::NUMERIC)    AS CD_PARC,
					COALESCE(CRED.DT_PARC, #{dtVd})       AS DT_PARC,
					COALESCE(CRED.VL_PARC, TEF.VL_CARTAO) AS VL_PARC,
					CASE 
							  WHEN COALESCE(CRED.CD_PARC, 0::NUMERIC) = 0::NUMERIC THEN 1
							  ELSE 0 
					END                              AS PARC_MNT_PDV_ERRO,
					CRED.CGC_CPF                     ,
					CRED.NR_FATURA                   
		  FROM     
				PDV_VD_TEF TEF 
		  LEFT JOIN RC_ADM_CARTAO ADM 
		ON        TEF.CD_EMP = ADM.CD_EMP 
		AND       TEF.CD_ADM_CARTAO = ADM.CD_ADM_CARTAO
		  LEFT JOIN PDV_VD_CRED CRED 
		ON        TEF.CD_EMP = CRED.CD_EMP 
		AND       TEF.CD_FILIAL = CRED.CD_FILIAL 
		AND       TEF.CD_VD = CRED.CD_VD 
		WHERE     
		  ADM.TP_ADM = 6::   NUMERIC 
			AND #{vlrCartao} > 0::NUMERIC 
			AND TEF.CD_EMP = #{cdEmp}
			AND TEF.CD_FILIAL =  #{cdFilial}
			AND TEF.CD_VD = #{cdVd}
	</select>
	<select id="pagamentoCartao" resultMap="pagamentoCartao"> 
		<![CDATA[	
	SELECT    	
                                                             CASE 
                                                                       WHEN COALESCE(TEF.CD_ADM_CARTAO, 0::NUMERIC) > 0::NUMERIC THEN TEF.CD_ADM_CARTAO
                                                                       WHEN TEF.CD_ADM_CARTAO = 0::NUMERIC
                                                                       AND       TEF.TP_ADM = 6 THEN
                                                                                 ( 
                                                                                        SELECT RC_ADM_CARTAO.CD_ADM_CARTAO
                                                                                        FROM   RC_ADM_CARTAO
                                                                                        WHERE  RC_ADM_CARTAO.CD_EMP = TEF.CD_EMP
                                                                                        AND    RC_ADM_CARTAO.TP_ADM = TEF.TP_ADM::NUMERIC
                                                                                        AND    RC_ADM_CARTAO.PARC = TEF.QT_PARC:: NUMERIC
                                                                                        AND    RC_ADM_CARTAO.STS_ADM = 0 LIMIT 1)
                                                                       ELSE NULL::NUMERIC 
                                                             END AS CD_ADM_CARTAO, 
                                                             CASE 
                                                                       WHEN COALESCE(TEF.CD_ADM_CARTAO, 0::NUMERIC) > 0::NUMERIC THEN ADM.NM_USUAL
                                                                       WHEN TEF.CD_ADM_CARTAO = 0::NUMERIC
                                                                       AND       TEF.TP_ADM = 6 THEN
                                                                                 ( 
                                                                                        SELECT RC_ADM_CARTAO.NM_USUAL
                                                                                        FROM   RC_ADM_CARTAO
                                                                                        WHERE  RC_ADM_CARTAO.CD_EMP = TEF.CD_EMP
                                                                                        AND    RC_ADM_CARTAO.TP_ADM = TEF.TP_ADM::NUMERIC
                                                                                        AND    RC_ADM_CARTAO.PARC = TEF.QT_PARC:: NUMERIC
                                                                                        AND    RC_ADM_CARTAO.STS_ADM = 0 LIMIT 1)
                                                                       ELSE NULL::CHARACTER VARYING
                                                             END                 AS NM_USUAL, 
                                                             TEF.VL_CARTAO       AS VL_CARTAO,
                                                             TEF.VL_SAQUE_CARTAO AS VL_SAQUE_CARTAO, 
                                                             CASE 
                                                                       WHEN TEF.QT_PARC > 0 THEN TEF.QT_PARC::NUMERIC
                                                                       ELSE ADM.PARC 
                                                             END              AS PARC, 
                                                             TEF.COD_REDE     AS COD_REDE, 
                                                             TEF.COD_BANDEIRA AS COD_BANDEIRA, 
                                                             CASE 
                                                                       WHEN TEF.COD_MODALIDADE::TEXT = ''::TEXT THEN '0'::CHARACTER VARYING
                                                                       ELSE TEF.COD_MODALIDADE 
                                                             END        AS COD_MODALIDADE, 
                                                             TEF.TP_ADM AS TP_ADM, 
                                                             CASE 
                                                                       WHEN COALESCE( 
                                                                                 CASE 
                                                                                           WHEN TEF.NSU_TEF = 0::NUMERIC THEN NULL::NUMERIC
                                                                                           ELSE TEF.NSU_TEF
                                                                                 END, 0::NUMERIC) > 0::NUMERIC
                                                                       AND 
                                                                                 CASE 
                                                                                           WHEN TEF.NSU_TEF = 0::NUMERIC THEN NULL::NUMERIC
                                                                                           ELSE TEF.NSU_TEF
                                                                                 END <> 1::NUMERIC THEN TEF.NSU_TEF
                                                                       WHEN 
                                                                                 CASE 
                                                                                           WHEN TEF.NSU_TEF = 0::NUMERIC THEN NULL::NUMERIC
                                                                                           ELSE TEF.NSU_TEF
                                                                                 END = 1::NUMERIC THEN TEF.CD_TRN_TEF
                                                                       WHEN COALESCE( 
                                                                                 CASE 
                                                                                           WHEN TEF.NSU_TEF = 0::NUMERIC THEN NULL::NUMERIC
                                                                                           ELSE TEF.NSU_TEF
                                                                                 END, 0::NUMERIC) = 0::NUMERIC THEN TEF.CD_TRN_TEF
                                                                       ELSE NULL::NUMERIC 
                                                             END AS "NR_TRANSACAO", 
                                                             CASE 
                                                                       WHEN COALESCE(TEF.NR_AUTORIZACAO, '0'::CHARACTER VARYING)::TEXT > '0'::TEXT
                                                                       AND       TEF.NR_AUTORIZACAO::TEXT <> '1'::TEXT THEN TEF.NR_AUTORIZACAO
                                                                       WHEN TEF.NR_AUTORIZACAO::TEXT = '1'::TEXT THEN TEF.CD_TRN_TEF::CHARACTER VARYING
                                                                       WHEN TEF.NR_AUTORIZACAO::TEXT = '0'::TEXT THEN TEF.CD_TRN_TEF::CHARACTER VARYING
                                                                       ELSE NULL::CHARACTER VARYING
                                                             END                                                     AS NR_AUTORIZACAO,
                                                             TEF.DS_BANDEIRA                                         AS BANDEIRA,
                                                             COALESCE(TEF.NR_ESTABELECIMENTO, ''::CHARACTER VARYING) AS NR_ESTABELECIMENTO,
                                                             COALESCE(TEF.NR_COMPROVANTE, ''::CHARACTER VARYING)     AS NR_COMPROVANTE,
                                                             CASE 
                                                                       WHEN TEF.GERENCIADOR_TEF = 1 THEN 'SCOPE'::CHARACTER VARYING
                                                                       WHEN TEF.TRN_POS = 1 THEN 'POS'::CHARACTER VARYING
                                                                       ELSE 'SITEF'::CHARACTER VARYING
                                                             END                              AS TEF_GATEWAY
                                                   FROM      PDV_VD_TEF TEF
												   LEFT JOIN RC_ADM_CARTAO ADM 
														ON        TEF.CD_EMP = ADM.CD_EMP 
														AND       TEF.CD_ADM_CARTAO = ADM.CD_ADM_CARTAO
                                                   WHERE    TEF.CD_EMP 		= #{cdEmp}
														AND TEF.CD_FILIAL 	= #{cdFilial}
														AND TEF.CD_VD 		= #{cdVd}
														]]>
	</select>
	<select id="pagamentoPbm" resultMap="pagamentoPbm"> 
		<![CDATA[
	 SELECT                 
					VD.CD_CONV   AS CD_CONV, 
                                                       CASE 
                                                              WHEN VD.TIPO_PBM::NUMERIC > 0::NUMERIC THEN
                                                                     CASE 
                                                                            WHEN VD.CD_CLI_PBM = 0::NUMERIC THEN
                                                                                   ( 
                                                                                          SELECT RC_CLI.CD_CLI
                                                                                          FROM   RC_CLI
                                                                                          WHERE  RC_CLI.ROT_CONV_EXT = VD.TIPO_PBM::NUMERIC
                                                                                          AND    RC_CLI.STS_CLI = 0::               NUMERIC LIMIT 1)
                                                                            ELSE VD.CD_CLI_PBM 
                                                                     END 
                                                              ELSE VD.CD_CLI 
                                                       END                     AS CD_CLI_CONV, 
                                                       NULL::CHARACTER VARYING AS CGC, 
                                                       VD.TIPO_PBM             AS TIPO_PBM, 
                                                       CASE VD.TIPO_PBM 
                                                              WHEN 1 THEN 'prevsaude'::TEXT 
                                                              WHEN 2 THEN 'vida-link'::TEXT 
                                                              WHEN 3 THEN 'e-pharma'::TEXT 
                                                              WHEN 4 THEN 'transaction center'::TEXT
                                                              WHEN 5 THEN 'farmacia popular'::TEXT
                                                              WHEN 6 THEN 'funcional card'::TEXT
                                                              ELSE 'outros'::TEXT 
                                                       END                                                AS NM_CONV,
                                                       VD.VLR_CONV_PBM                                    AS VLR_CONV_PBM,
                                                       COALESCE(IT.NR_AUTORIZACAO_PBM, IT.NR_ORC_VD_LINK) AS CD_AUTORIZACAO,
                                                       IT.CD_IT                                           AS CD_IT,
                                                       IT.CD_PROD                                         AS CD_PROD,
                                                       IT.VLR_AVISTA_PBM                                  AS VLR_AVISTA_PBM,
                                                       COALESCE( 
                                                       CASE 
                                                              WHEN IT.VLR_REEMBOL_PBM = 0::NUMERIC THEN NULL::NUMERIC
                                                              ELSE IT.VLR_REEMBOL_PBM 
                                                       END , 
                                                       CASE 
                                                              WHEN IT.VLR_REEMBOL = 0::NUMERIC THEN 0::NUMERIC
                                                              ELSE IT.VLR_REEMBOL 
                                                       END)		    AS VLR_REEMBOL,                       
                                                       COALESCE(IT.VLR_CONV_PBM   , 0::NUMERIC)               AS VLR_PROD_CONV
													   FROM   PDV_VD VD 
													   INNER JOIN    PDV_VD_IT IT ON
													   VD.CD_EMP = IT.CD_EMP
													   AND       IT.CD_FILIAL = VD.CD_FILIAL 
														AND       IT.CD_VD = VD.CD_VD
														WHERE     #{cdEmp} = VD.CD_EMP 
															AND   #{cdFilial} = VD.CD_FILIAL 
															AND   #{cdVd} = VD.CD_VD
															AND 	  ( LENGTH(IT.NR_AUTORIZACAO_PBM) > 1 OR LENGTH(IT.NR_ORC_VD_LINK)> 1 )
															]]>
	</select>
	<select id="pagamentoNcc" resultMap="pagamentoNcc"> 
	SELECT  NCC.CD_CTR_NCC  ,
			NCC.VLR_NCC 	
    FROM 
		PDV_VD_NCC NCC 
	 WHERE
		#{cdEmp} = NCC.CD_EMP 
		AND #{cdFilial} = NCC.CD_FILIAL 
		AND #{cdVd} = NCC.CD_VD LIMIT 1	
	</select>
	<select id="pagamentoValeCp" resultMap="pagamentoValeCp"> 
	SELECT  
                                                       PDV_VD_RC_CLI_FIDELI_VALE_COMPRA.CD_CTR_VALE_CP ,
                                                       PDV_VD_RC_CLI_FIDELI_VALE_COMPRA.VLR_VALE_CP    
                                                FROM   PDV_VD_RC_CLI_FIDELI_VALE_COMPRA 
												WHERE  PDV_VD_RC_CLI_FIDELI_VALE_COMPRA.CD_EMP    = #{cdEmp}
                                                AND    PDV_VD_RC_CLI_FIDELI_VALE_COMPRA.CD_FILIAL = #{cdFilial}
                                                AND    PDV_VD_RC_CLI_FIDELI_VALE_COMPRA.CD_VD     = #{cdVd}
	</select>
	<update id="consumePdv" parameterType="Map">
    update pdv_vd set flag_consolidado = 2 where CD_EMP = #{cdEmp} and CD_FILIAL = #{cdFilial} and CD_VD = #{cdVd}
	</update>
	<update id="consumePdvReprocessar" parameterType="Map">
    update pdv_vd set flag_consolidado = 0 where CD_EMP = #{cdEmp} and CD_FILIAL = #{cdFilial} and CD_VD = #{cdVd}
	</update>
	<select id="selectMapaResumo" resultMap="selectMapaResumo">

	SELECT 'mapaResumo' as "tipoRegistro",
    resumo.cd_emp ,
    resumo.cd_filial ,
    resumo.dt_ecf,
    resumo.cd_cx ,
    0 AS "stVd",
    resumo.dt_cad ,
    resumo.dt_cad::date + resumo.hr_cad::time without time zone AS "hrCad",
    resumo.cont_red_z ,
    resumo.cont_ord_op_ini ,
    resumo.cont_ord_op_fin ,
    resumo.cont_reinicio_op,
    resumo.vlr_gt_ini ,
    resumo.vlr_gt_fin ,
    resumo.vlr_vend_bruta ,
    resumo.vlr_desc ,
    resumo.vlr_canc ,
    resumo.vlr_contab  ,
    resumo.vlr_icms    ,
    resumo.vlr_isentas ,
    resumo.vlr_n_trib  ,
    resumo.vlr_base_icms_subs 	,
    resumo.vlr_issqn 			,
    resumo.vlr_desc_issqn 		,
    resumo.vlr_cancel_issqn 	, 
    aliquotas.tx_icms 			,
    aliquotas.base_calc 		,
    COALESCE(aliquotas.tipo_imposto, 0::numeric) AS tipo_imposto,
    round(aliquotas.base_calc * aliquotas.tx_icms / 100::numeric, 2) AS "vlrTxIcms"
   FROM pdv_mapa_resumo resumo
     LEFT JOIN pdv_mapa_resumo_cpl aliquotas ON resumo.cd_emp = aliquotas.cd_emp AND resumo.cd_filial = aliquotas.cd_filial AND resumo.dt_ecf = aliquotas.dt_ecf AND resumo.cd_cx = aliquotas.cd_cx
	 WHERE resumo.flag_consolidado = 0 order by resumo.dt_ecf desc LIMIT 1 
	</select>
	<update id="consumeMapaResumo" parameterType="Map">
    update pdv_mapa_resumo set flag_consolidado = 1 where CD_EMP = #{cdEmp} and CD_FILIAL = #{cdFilial} and CD_CX = #{cdCx} and DT_ECF =  #{dtEcf}
	</update>
	<select id="selectConsoldVd" resultMap="selectConsoldVd">
		<![CDATA[
	
		select 'pdvConsoldVd' as "tipoRegistro",
		  cd_emp ,
		  cd_filial ,
		  cd_cx ,
		  dt_mov ,
		  nr_cupom_ini ,
		  nr_cupom_fim ,
		  vlr_vd_liq ,
		  cd_usu ,
		  dt_cad ,
		  vl_receb ,
		  vl_serv 
		from pdv_consld_vd where flag_consolidado = #{flagConsolid}::numeric and cd_usu > 1 LIMIT 1 
	 ]]>
	</select>
	<update id="consumeConsoldVd" parameterType="Map">
    update pdv_consld_vd set flag_consolidado = 1 where CD_EMP = #{cdEmp} and CD_FILIAL = #{cdFilial} and CD_CX = #{cdCx} and DT_MOV =  #{dtMov}
	</update>
	<update id="consumeConsoldVdReprocessar" parameterType="Map">
    update pdv_consld_vd set flag_consolidado = 2 where CD_EMP = #{cdEmp} and CD_FILIAL = #{cdFilial} and CD_CX = #{cdCx} and DT_MOV =  #{dtMov}
	</update>
	<update id="consumeConsoldVdErro" parameterType="Map">
   <![CDATA[  update pdv_vd set flag_consolidado = 0 where flag_consolidado = 2 and hr_vd < (now() - interval '30 minutes') ]]>
	</update>
	<select id="selectConciliacaoPdvVd" resultMap="selectConciliacaoPdvVd">
		select 'pdvVdConciliacao' as "tipoRegistro"
	</select>
	<select id="selectConciliacaoPdvVdCupons" resultMap="selectConciliacaoPdvVdCupons">
		<![CDATA[select  cd_emp ,
		  cd_filial ,
		  cd_cx ,
		  nr_ecf ,
		  dt_vd ,
		  st_Vd 
		from pdv_vd 
		where cd_emp = 1 
				and cd_filial in ((select cd_filial from prc_filial) )
				and st_vd >= 0 
				AND (now() - interval '3 hours' ) <= case flag_nfce
									when 1 then hr_vd
									else dt_cad
								end 
				]]>
	</select>
	<resultMap id="selectCupom" type="Map"> 	
		<result property="cnpjFilial" column="CGC"/>
		<result property="cdEmp" column="CD_EMP"/> 
		<result property="cdFilial" column="CD_FILIAL"/> 
		<result property="cdCx" column="CD_CX"/> 
		<result property="dtVd" column="DT_VD"/> 
		<result property="dtCad" column="DT_CAD"/> 
		<result property="hrVd" column="HR_VD"/>  
		<result property="nrPedTelevd" column="NR_PED_TELEVD"/> 
		<result property="origemOrc" column="ORIG_ORC"/> 
		<result property="cdVd" column="CD_VD"/> 
		<result property="nrEcf" column="NR_ECF"/> 
		<result property="stVd" column="ST_VD"/> 
		<result property="contadorCupomFiscal" column="CONT_CUPOM_FISC"/> 
		<result property="codigoMovimento" column="CD_MOV"/> 
		<result property="cdCli" column="CD_CLI"/> 
		<result property="cgcCli" column="CGC_CPF"/> 
		<result property="numeroCartao" column="NR_CARTAO_MARKA"/>                           
		<result property="diasProrrogConv" column="QTD_DIAS_PRORROG"/> 
		<result property="vlrLiqVd" column="VLR_LIQ_VD"/> 
		<result property="vlrTotProd" column="VLR_TOT_PROD"/> 
		<result property="vlrVd" column="VLR_VD"/> 
		<result property="vlrDesc" column="VLR_DESC"/> 
		<result property="vlrDescItens" column="VLR_DESC_ITENS"/> 
		<result property="vlrDinh" column="VLR_DINH"/> 
		<result property="vlrTroco" column="VLR_TROCO"/> 
		<result property="vlrConv" column="VLR_CONV"/>
		<result property="cdConv" column="CD_CONV"/>
		<result property="qtParcConv" column="QT_PARC_CONV"/>
		<result property="vlrDup" column="VLR_DUP"/>
		<result property="valorChequeAVista" column="VL_CHQS_A_VISTA"/>
		<result property="valorChequeAPrazo" column="VL_CHQS_A_PRZ"/>                           
		<result property="nrCelRecarga" column="NR_CEL_RECARGA"/>
		<result property="vlrRecargaCel" column="VLR_RECARGA_CEL"/>
		<result property="nmOperCel" column="NM_OPER_CEL"/>
		<result property="nmComprador" column="NM_COMPRADOR"/>
		<result property="dadosAdicionais" column="DADOS_ADICIONAIS"/>
		<result property="nrSerieEcf" column="NR_SERIE_IMP"/>
		<result property="versaoPdv" column="VS_PDV"/>
		<result property="versaoPdvRc" column="VS_PDV_RC"/>
		<result property="cdOperador" column="CD_USU"/>
		<result property="cdUsuCancel" column="CD_USU_CANCEL"/>
		<result property="codigoMotivoCancelamento" column="CD_MT_CANCEL"/>
		<result property="stCancPaf" column="ST_CANC_PAF"/>
		<result property="cdOutroProcedimento" column="CD_OUTR_PROCD"/>
		<result property="cdUsuProcedimento" column="CD_USU_PROCEDIMENTO"/>
		<result property="cdCliPbm" column="CD_CLI_PBM"/>
		<result property="registroalterado" column="REG_ALTERADO"/>
		<result property="isDebitarPontos" column="VD_TROCA_FIDEL"/>
		<result property="valorIbpt" column="VLR_IMPOSTO"/>
		<result property="percentualIbpt" column="TX_MED_IMPOSTO"/>
		<result property="vlrConvPbm" column="VLR_CONV_PBM"/>
		<result property="flagNfce" column="FLAG_NFCE"/>
		<result property="cdNfSai" column="CD_NF"/>
		<result property="nrCartaoMarka" column="NR_CARTAO_MARKA"/>
		<result property="qtdePontosFidelExterno" column="QTDE_PONTOS_FIDEL_EXTERNO"/>
		<result property="nrTelCupom" column="NR_TEL_CUPOM"/>
		<result property="chvNfce"	column="CHV_NFCE"/>	
		<result property="cdNfSerie"	column="CD_NF_SERIE"/>	
		<result property="vlrTickets" column="VLR_TICKETS"/>
		<association property="nfce" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdNf=NR_ECF,cdNfSerie=CD_NF_SERIE}" javaType="Map" select="selectCupomNfce"/>
		<association property="nfceCancel" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="Map" select="selectCupomNfceCancel"/>
		<association property="orcamento" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,nrOrc=NR_ORC}" javaType="Map" select="selectOrcamentoPdv"/>
		<association property="pagamento" javaType="Map">
			<association property="ncc" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="Map" select="pagamentoNcc"/>
			<collection property="cheque" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="pagamentoCheque" />	
			<collection property="crediario" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD,vlrCartao=VLR_CARTAO,dtVd=DT_VD}" javaType="ArrayList" ofType="map" select="pagamentoCrediario" />	
			<collection property="cartao" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="pagamentoCartao" />
			<collection property="pbm" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="pagamentoPbm" />		
			<collection property="valeCompra" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="pagamentoValeCp" />				
		</association>
		<collection property="itens" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="selectCupomItens" />		
		<collection property="receita" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,nrOrc=NR_ORC,cdVd=CD_VD}" javaType="ArrayList" ofType="map" select="selectCupomReceita" />
	</resultMap>
	<resultMap id="selectCupomItens" type="Map"> 
		<result property="cdEmp" column="CD_EMP"/> 
		<result property="cdFilial" column="CD_FILIAL"/> 
		<result property="cdVd" column="CD_VD"/> 
		<result property="cdIt"	column="CD_IT"/>	
		<result property="cdBarra"	column="CD_BARRAS"/>	
		<result property="cdProd"	column="CD_PROD"/>	
		<result property="qtIt"	column="QT_IT"/>	
		<result property="vlrIt"	column="VLR_IT"/>	
		<result property="totIt"	column="VLR_LIQ_IT"/>	
		<result property="stIt"	column="ST_IT"/>	
		<result property="tipoDesconto"	column="TIPO_DESCONTO"/>	
		<result property="txDesc"	column="TX_DESC"/>	
		<result property="percDescVerba"	column="PERC_DESC_VERBA"/>	
		<result property="vlrDescVerba"	column="VLR_DESC_VERBA"/>	
		<result property="vlrDescRateio"	column="VLR_DESC_TOT_RAT"/>	
		<result property="cdTribFc"	column="CD_TRIB_FC"/>	
		<result property="txIcmsIt"	column="TX_ICMS_IT"/>	
		<result property="txRedIt"	column="TX_RED_IT"/>	
		<result property="cdVend"	column="CD_VEND"/>	
		<result property="cdVendVerba"	column="CD_VEND_VERBA"/>	
		<result property="cdUsuCancel"	column="CD_USU_CANCEL"/>	
		<result property="qtPontosFidel"	column="QTDE_PONTO_FIDEL"/>	
		<result property="cdGrupoComissao"	column="CD_GRP_COMIS_PDV"/>	
		<result property="registroalteradoitem"	column="REG_ALTERADO"/>	
		<result property="tipoImposto"	column="TIPO_IMPOSTO"/>	
		<result property="valorIbptItem"	column="VLR_IMPOSTO_IT"/>	
		<result property="percentualIbptItem"	column="TX_IMPOSTO_IT"/>	
		<result property="nrProtocoloManipulado"	column="NR_PROTOCOLO_MANIPULADO"/>	
		<result property="percDescDiff"	column="PERC_DESC_DIFF"/>	
		<result property="percDescMax"	column="PERC_DESC_MAX"/>	
		<result property="percDescMin"	column="PERC_DESC_MIN"/>	
		<result property="cdTblDesc"	column="CD_TBL_DESC"/>	
		<result property="tpNivel"	column="TP_NIVEL"/>	
		<result property="tpTblDesc" column="TP_TBL_DESC"/>	
		<!-- <collection property="lote" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdVd=CD_VD,cdIt=CD_IT}" javaType="ArrayList" ofType="map" select="selectCupomItensLote" /> -->
		 
	</resultMap>
	<resultMap id="selectCupomItensLote" type="Map"> 
		<result property="cdLote"	column="CD_LOTE"/>
		<result property="nrLote"	column="NR_LOTE"/>
		<result property="qtdeLote"	column="QTDE_LOTE"/>
	</resultMap>
	<resultMap id="selectCupomNfce" type="Map"> 
		<result property="cdEmp" column="CD_EMP"/> 
		<result property="cdFilial" column="CD_FILIAL"/> 
		<result property="cdNf"	column="CD_NF"/>	
		<result property="cdNfSerie"	column="CD_NF_SERIE"/>	
		<result property="chvNfce"	column="CHV_NFCE"/>	
		<result property="autNfce"	column="AUT_NFCE"/>	
		<result property="xmlNfce"	column="XML_NFCE"/>	
		<result property="dsMotivo"	column="DS_MOTIVO"/>	
		<result property="stsValid"	column="STS_VALID"/>	
	</resultMap>
	<resultMap id="selectCupomNfceCancel" type="Map"> 
		<result property="cdEmp" column="CD_EMP"/> 
		<result property="cdFilial" column="CD_FILIAL"/> 
		<result property="cdVd"	column="CD_VD"/>	
		<result property="tpCanc"	column="TP_CANC"/>	
		<result property="xmlCancel"	column="XML_CANC"/>	
		<result property="chvNfceCancel"	column="CHV_NFCE"/>	
		<result property="dtEmisCancel"	column="DT_EMIS"/>	
		<result property="autCanc"	column="AUT_CANC"/>	
		<result property="dsMotivoCancel"	column="DS_MOTIVO"/>	
	</resultMap>	
	<resultMap id="OrcaJsonResult" type="Map">
		<result column="cd_emp" property="cdEmp"/>
		<result column="cd_filial" property="cdFilial"/>
		<result column="cd_orc" property="cdOrc"/>
		<result column="vd_troca_fidel" property="vdTrocaFidel"/>
		<result column="cd_conv" property="cdConv"/>
		<result column="qt_parc_conv" property="qtParcConv"/>
		<result column="nr_ped_televd" property="nrPedTelevd"/>
		<result column="tipo_prazo_pgto" property="tipoPrazoPgto"/>
		<result column="nr_cartao_pbm" property="nrCartaoPbm"/>
		<result column="cd_projeto_pbm" property="cdProjetoPbm"/>
		<result column="tp_perc_rec_conv" property="tpPercRecConv"/>
		<result column="perc_rec_conv" property="percRecConv"/>
		<result column="dados_adicionais" property="dadosAdicionais"/>
		<result column="nm_comprador" property="nmComprador"/>
		<result column="qtd_dias_prorrog" property="qtdDiasProrrog"/>
		<result column="tipo_pbm" property="tipoPbm"/>
		<result property="cdCli" column="CD_CLI"/>
		<result column="cd_cli_dep" property="cdCliDep"/>
		<result column="vlr_prod" property="vlrProd"/>
		<result column="tp_orc_entg" property="tpOrcEntg"/>
		<result column="sts_orc" property="stsOrc"/>
		<result column="nm_cli" property="nmCli"/>
		<result column="nr_autr_pbm" property="nrAutrPbm"/>
		<result column="cpf_cli_pbm" property="cpfCliPbm"/>
		<result column="dt_emi" property="dtEmi"/>
		<result column="hr_emi" property="hrEmi"/>
		<result column="vlr_tot" property="vlrTot"/>
		<result column="vlr_desc" property="vlrDesc"/>
		<result column="vlr_desc_geral" property="vlrDescGeral"/>
		<result column="nr_cartao_fidelidade" property="nrCartaoCli"/>
		<result column="fone_cli" property="foneCli"/>
		<result column="tp_orc" property="tpOrc"/>
		<result column="cd_frm_pgto" property="cdFrmPgto"/>
		<result column="orig_orc" property="origOrc"/>
		<result column="obs" property="obs"/>
		<result column="cd_mt_cancel_orc" property="cdMtCancelOrc"/>
		<result column="desc_mt_cancel" property="descMtCancel"/>	
		<collection property="itens" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdOrc=CD_ORC}" javaType="ArrayList" ofType="map" select="selectOrcamentoPdvItem" />
		<collection property="receita" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdOrc=CD_ORC}" javaType="ArrayList" ofType="map" select="selectOrcamentoPdvReceita" />
	</resultMap>	
	<resultMap id="OrcamentoItem" type="Map">
		<result column="cd_emp"                  property="cdEmp"/>
		<result column="cd_prod"                 property="cdProd"/>
		<result column="cd_barra"                property="cdBarra"/>
		<result column="qt"                      property="qt"/>
		<result column="vlr_it"                  property="vlrIt"/>
		<result column="vlr_tot_it"              property="vlrTotIt"/>
		<result column="vlr_desc"                property="vlrDesc"/>
		<result column="perc_desc"               property="percDesc"/>
		<result column="cd_medico_rec"           property="cdMedicoRec"/>
		<result column="cd_vend"                 property="cdVend"/>
		<result column="cd_vend_lib"             property="cdVendLib"/>
		<result column="pr_tab"                  property="prTab"/>
		<result column="nr_autr_pbm_item"        property="nrAutrPbmItem"/>
		<result column="cd_vend_verba"           property="cdVendVerba"/>
		<result column="libera_vd_conv"          property="liberaVdConv" />
		<result column="cd_it"                   property="cdIt"/>
		<result column="perc_desc_min"           property="percDescMin"/>
		<result column="perc_desc_max"           property="percDescMax"/>
		<result column="cd_tbl_desc"             property="cdTblDesc"/>
		<result column="oferta"                  property="oferta"/>
		<result column="perc_desc_cad"           property="percDescCad"/>
		<result column="perc_desc_fix"           property="percDescFix"/>
		<result column="vlr_desc_fix"            property="vlrDescFix"/>
		<result column="tipo_desconto"           property="tipoDesconto"/>
		<result column="vlr_economia"            property="vlrEconomia"/>
		<result column="venda_dependente"        property="vendaDependente"/>
		<result column="perc_desconto_pos_pbm"   property="percDescontoPosPbm"/>
		<result column="nr_protocolo_manipulado" property="nrProtocoloManipulado"/>
		<result column="tipo_desconto"           property="tpDesc"/>
		<result column="qtde_ponto_fidel"        property="qtPontosFidel"/>
		<result column="vlr_desc_verba"          property="vlrDescVerba"/>
		<result column="perc_desc_verba"         property="percDescVerba"/>
		<result column="cd_vend_verba"           property="cdVendVerba"/>
		<result column="vlr_custo_semaforo"      property="vlrCustoSemaforo"/>
		<result column="qt_est"                  property="qtEst"/>
		<result column="cd_grp"                  property="cdGrupoComissao"/>			
		<!--<association property="lote" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdOrc=CD_ORC,cdProd=CD_PROD,cdIt=CD_IT}" javaType="Map" select="selectOrcamentoPdvItemLote" /> -->
		<association property="concorrente" column="{cdEmp=CD_EMP,cdFilial=CD_FILIAL,cdOrc=CD_ORC,cdProd=CD_PROD,cdIt=CD_IT}" javaType="Map" select="selectOrcamentoPdvItemConcorrente" />
	</resultMap>
	<resultMap id="OrcamentoItemConcorrente" type="Map">
		<result column="cd_prod"                property="cdProd"/>
		<result column="nr_orc"                 property="nrOrc"/>
		<result column="cd_vend"                property="cdVend"/>
		<result column="cd_concor"              property="cdConcorrente"/>
		<result column="vlr_concor"             property="vlrConcorrente"/>
		<result column="perc_desc"              property="percDesc"/>
		<result column="cd_it"                  property="cdIt"/>
	</resultMap>
	<resultMap id="OrcamentoReceita" type="Map">
		<result column="cd_prod"                  property="cdProd"/> 
		<result column="cd_it"                    property="cdIt"/> 
		<result column="nm_comprador"             property="nmCompradorRec"/> 
		<result column="idade"                    property="idadeRec"/> 
		<result column="nm_paciente"              property="nmPacienteRec"/> 
		<result column="receita_tipo"             property="receitaTipoRec"/> 
		<result column="cid"          			property="cidRec"/> 
		<result column="uf"                       property="ufRec"/> 
		<result column="nr_doc_cli"               property="nrDocCliRec"/> 
		<result column="tipo_documento"           property="tipoDocumentoRec"/> 
		<result column="cd_medico_rec" 			property="cdMedicoRec"/> 
		<result column="qt_prod"                  property="qtProd"/> 
		<result column="dt_receita"               property="dtReceita"/> 
		<result column="tp_capt_receita"          property="tipoCaptacaoReceita"/>                     
	</resultMap>	
	<resultMap id="OrcamentoItemLote" type="Map">
		<result column="cd_lote"                property="cdLote"/>
		<result column="qtde_lote"              property="qtdeLote"/>                       
	</resultMap>	
	<resultMap id="selectCupomReceita" type="Map">
		<result column="CD_EMP"       property="cdEmp"/> 
		<result column="CD_FILIAL"    property="cdFilial" /> 
		<result column="CD_VD"        property="cdVd"	/>
		<result column="CD_IT"                    property="cdIt"/> 
		<result column="COMPRADOR_NOME"             property="compradorNome"/> 
		<result column="PACIENTE_IDADE"                    property="pacienteIdade"/> 
		<result column="PACIENTE_NOME"              property="pacienteNome"/> 
		<result column="RECEITA_TIPO"             property="receitaTipoRec"/> 
		<result column="PACIENTE_CID"          			property="pacienteCid"/> 
		<result column="COMPRADOR_DOC_UF"                       property="compradorDocUf"/> 
		<result column="COMPRADOR_DOC_NUMERO"               property="compradorDocNumero"/> 
		<result column="COMPRADOR_DOC_TIPO"           property="compradorDocTipo"/> 
		<result column="PRESCRITOR_ID" 			property="prescritorId"/> 
		<result column="QT_PROD"                  property="qtProd"/> 
		<result column="RECEITA_DATA"               property="receitaData"/> 
		<result column="TP_CAPT_RECEITA"          property="tipoCaptacaoReceita"/>   
		<result column="PACIENTE_SEXO"          property="pacienteSexo"/>  
		<result column="NR_RECEITA"          property="receitaNumero"/>
		<result column="TP_DOC_EXP"          property="tipoDocumentoRec"/>	
		<result column="pacienteTipoIdade"          property="pacienteTipoIdade"/>	
	</resultMap>	
	<resultMap id="pagamentoCheque" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="cdBc" column="CD_BC_CHQ"/>	
		<result property="nrOrd" column="NR_ORD"/>	
		<result property="nrChq" column="NR_CHQ"/>	
		<result property="anoChq" column="ANO_CHQ"/>	
		<result property="vlrChq" column="VL_CHQ"/>	
		<result property="dtEmi" column="DT_EMI"/>	
		<result property="dtVencto" column="DT_VENCTO"/>	
		<result property="agChq" column="AG_CHQ"/>	
		<result property="cdEmi" column="CD_EMI"/>	
		<result property="cgcEmi" column="CPF_CGC_EMI"/>	
		<result property="nmEmi" column="NM_EMI"/>	
		<result property="foneEmi" column="FONE_EMI"/>	
		<result property="nrCntChq" column="NR_CNT_CHQ"/>	
		<result property="autChq" column="AUT_CHQ"/>	
		<result property="compChq" column="COMP_CHQ"/>	
		<result property="c1Chq" column="C1_CHQ"/>	
		<result property="c2Chq" column="C2_CHQ"/>	
		<result property="c3Chq" column="SR_CHQ"/>	
		<result property="cmc7Chq" column="CMC7_CHQ"/>	
		<result property="mesAnoCntChq" column="MES_ANO_CNT_CHQ"/>	
	</resultMap>
	<resultMap id="pagamentoCrediario" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="cdAdmCartao" column="CD_ADM_CARTAO"/>	 
		<result property="nmUsual" column="NM_USUAL"/>	 
		<result property="vlrCartao" column="VL_CARTAO"/>	
		<result property="vlrSaque" column="VL_SAQUE_CARTAO"/>	 
		<result property="qtParc" column="PARC"/>	 
		<result property="codRede" column="COD_REDE"/>	 
		<result property="codBandeira" column="COD_BANDEIRA"/>	
		<result property="codModalidade" column="COD_MODALIDADE"/>	
		<result property="nsuTef" column="NSU_TEF"/>
		<result property="nrAutorizacao" column="NR_AUTORIZACAO"/>			
		<result property="tefGateway" column="TEF_GATEWAY"/>	
		<result property="cdParc" column="CD_PARC"/>	
		<result property="dtParc" column="DT_PARC"/>	
		<result property="vlrParc" column="VL_PARC"/>	
		<result property="parcMntPdvErro" column="PARC_MNT_PDV_ERRO"/>	
		<result property="cgcCpf" column="CGC_CPF"/>	
		<result property="nrFatura" column="NR_FATURA"/>
	</resultMap>
	<resultMap id="pagamentoCartao" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="cdAdmCartao" column="CD_ADM_CARTAO"/>	 
		<result property="nmUsual" column="NM_USUAL"/>	 
		<result property="vlrCartao" column="VL_CARTAO"/>	
		<result property="vlrSaque" column="VL_SAQUE_CARTAO"/>	 
		<result property="qtParc" column="PARC"/>	 
		<result property="codRede" column="COD_REDE"/>	 
		<result property="codBandeira" column="COD_BANDEIRA"/>	
		<result property="codModalidade" column="COD_MODALIDADE"/>	
		<result property="nsuTef" column="NSU_TEF"/>
		<result property="nrAutorizacao" column="NR_AUTORIZACAO"/>			
		<result property="tefGateway" column="TEF_GATEWAY"/>	
		<result property="cdParc" column="CD_PARC"/>	
		<result property="dtParc" column="DT_PARC"/>	
		<result property="vlrParc" column="VL_PARC"/>	
		<result property="parcMntPdvErro" column="PARC_MNT_PDV_ERRO"/>	
		<result property="cgcCpf" column="CGC_CPF"/>	
		<result property="nrFatura" column="NR_FATURA"/>
		<result property="tpAdministradora" column="TP_ADM"/>
		<result property="nrTransacao" column="NR_TRANSACAO"/>
		<result property="bandeira" column="BANDEIRA"/>
		<result property="nrEstabelecimento" column="NR_ESTABELECIMENTO"/>
		<result property="nrComprovante" column="NR_COMPROVANTE"/>
	</resultMap>		
	<resultMap id="pagamentoPbm" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="cdConv" column="CD_CONV"/>	 
		<result property="cdCliConv" column="CD_CLI_CONV"/>	 
		<result property="cgcConv" column="CGC"/>	 
		<result property="tipoPbm" column="TIPO_PBM"/>	
		<result property="nmConv" column="NM_CONV"/>	
		<result property="vlrConv" column="VLR_CONV_PBM"/>	
		<result property="cdAutorizacao" column="CD_AUTORIZACAO"/>	
		<result property="cdIt" column="CD_IT"/>	
		<result property="cdProd" column="CD_PROD"/>	
		<result property="vlrProdCli" column="VLR_AVISTA_PBM"/>	
		<result property="vlrProdReembolso" column="VLR_REEMBOL"/>	                       
		<result property="vlrProdConv" column="VLR_PROD_CONV"/>
	</resultMap>	
	<resultMap id="pagamentoValeCp" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="vlrTickets" column="VLR_TICKETS"/>
		<result property="cdCtrValeCp" column="CD_CTR_VALE_CP"/>
		<result property="vlrValeCp" column="VLR_VALE_CP"/>
	</resultMap>
	<resultMap id="pagamentoNcc" type="Map">
		<result property="cdEmp" column="CD_EMP"/>
		<result property="cdFilial" column="CD_FILIAL"/>
		<result property="cdVd" column="CD_VD"/>
		<result property="cdCtrNcc" column="CD_CTR_NCC"/>
		<result property="vlrNcc" column="VLR_NCC"/>
	</resultMap>
	<resultMap id="selectMapaResumo" type="Map">	
		<result property="tipoRegistro" column="tipoRegistro"/>	
		<result property="cdEmp" column="cd_emp"/>	
		<result property="cdFilial" column="cd_filial"/>	
		<result property="dtEcf" column="dt_ecf"/>	
		<result property="cdCx" column="cd_cx"/>	
		<result property="stVd" column="stVd"/>	
		<result property="dtCad" column="dt_cad"/>	
		<result property="hrCad" column="hrCad"/>	
		<result property="contRedZ" column="cont_red_z"/>	
		<result property="contOrdOpIni" column="cont_ord_op_ini"/>	
		<result property="contOrdOpFin" column="cont_ord_op_fin"/>	
		<result property="contReinicioOp" column="cont_reinicio_op"/>	
		<result property="gtIni" column="vlr_gt_ini"/>	
		<result property="gtFin" column="vlr_gt_fin"/>	
		<result property="vlrVendaBruta" column="vlr_vend_bruta"/>	 
		<result property="vlrDesc" column="vlr_desc"/>	 
		<result property="vlrCanc" column="vlr_canc"/>	 
		<result property="vlrContab" column="vlr_contab"/>	 
		<result property="vlrIcms" column="vlr_icms"/>	 
		<result property="vlrIsentas" column="vlr_isentas"/>	 
		<result property="vlrNaoTrib" column="vlr_n_trib"/>	 
		<result property="vlrBaseIcmsSubs" column="vlr_base_icms_subs"/>	 
		<result property="vlrIssqn" column="vlr_issqn"/>	 
		<result property="vlrDescIssqn" column="vlr_desc_issqn"/>	 
		<result property="vlrCancelIssqn" column="vlr_cancel_issqn"/>	 
		<result property="txIcms" column="tx_icms"/>	 
		<result property="baseCalc" column="base_calc"/>	 
		<result property="tipoImposto" column="tipo_imposto"/>	
		<result property="vlrTxIcms" column="vlrTxIcms"/>
	</resultMap>
	<resultMap id="selectConsoldVd" type="Map">	
		<result property="tipoRegistro" column="tipoRegistro"/>	
		<result property="cdEmp" column="cd_emp"/>	
		<result property="cdFilial" column="cd_filial"/>	
		<result property="cdCx" column="cd_cx"/>	
		<result property="dtMov" column="dt_mov"/>	
		<result property="nrCupomIni" column="nr_cupom_ini"/>	
		<result property="nrCupomFim" column="nr_cupom_fim"/>	
		<result property="vlrVdLiq" column="vlr_vd_liq"/>	
		<result property="cdUsu" column="cd_usu"/>	
		<result property="dtCad" column="dt_cad"/>	
		<result property="vlReceb" column="vl_receb"/>	
		<result property="vlServ" column="vl_serv"/>
	</resultMap>
	<resultMap id="selectConciliacaoPdvVd" type="Map">	
		<result property="tipoRegistro" column="tipoRegistro"/>
		<collection property="cupons" column="tipoRegistro=tipoRegistro" javaType="ArrayList" ofType="map" select="selectConciliacaoPdvVdCupons" />		
	</resultMap>
	<resultMap id="selectConciliacaoPdvVdCupons" type="Map">	
		<result property="cdEmp" column="cd_emp"/>	
		<result property="cdFilial" column="cd_filial"/>	
		<result property="cdCx" column="cd_cx"/>	
		<result property="nrEcf" column="nr_ecf"/>	
		<result property="dtVd" column="dt_vd"/>	
		<result property="stVd" column="st_Vd"/>	   
	</resultMap>
</mapper>
